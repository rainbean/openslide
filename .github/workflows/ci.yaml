name: CI

on:
  push:
    branches:
      - z-stack

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - name: Check out repo
      uses: actions/checkout@v3
    - name: Install dependencies
      run: |
        sudo apt-get update && \
        sudo apt-get install \
          gcc make autoconf automake libtool pkg-config \
          zlib1g-dev \
          libpng-dev \
          libjpeg-turbo8-dev \
          libtiff5-dev \
          libopenjp2-7-dev \
          libgdk-pixbuf2.0-dev \
          libxml2-dev \
          libsqlite3-dev \
          libcairo2-dev \
          libglib2.0-dev \
          doxygen
    - name: Build
      run: |
        autoreconf -i
        ./configure
        make -j4
    - name: Check exports
      if: ${{ matrix.os == 'ubuntu-latest' }}
      run: cd test && ./driver exports
